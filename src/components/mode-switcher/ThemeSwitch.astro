---
import { Icon } from "astro-icon/components"
---

<button type="button" class="ThemeSwitch" id="ThemeSwitch">
  <Icon name="lucide:sun-medium" size={32} class="to-light" aria-label="ライトテーマに切り替え" />
  <Icon name="mdi:moon-and-stars" size={32} class="to-dark" aria-label="ダークテーマに切り替え" />
</button>

<style>
  .ThemeSwitch {
    appearance: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    margin: 0;
    color: var(--gray-400);
  }
  .to-light {
    display: none;
  }
  .to-dark {
    display: block;
  }
  :global(.dark) .to-light {
    display: block;
  }
  :global(.dark) .to-dark {
    display: none;
  }
</style>

<script is:inline>
  const DARK_CLASS = "dark"
  const LIGHT_CLASS = "light"

  const $root = document.documentElement
  const isDarkQuery = window.matchMedia("(prefers-color-scheme: dark)")

  if (isDarkQuery.matches) {
    $root.classList.add(DARK_CLASS)
    $root.classList.remove(LIGHT_CLASS)
  } else {
    $root.classList.add(LIGHT_CLASS)
    $root.classList.remove(DARK_CLASS)
  }

  isDarkQuery.addEventListener("change", (e) => {
    if (e.matches) {
      $root.classList.add(DARK_CLASS)
      $root.classList.remove(LIGHT_CLASS)
    } else {
      $root.classList.add(LIGHT_CLASS)
      $root.classList.remove(DARK_CLASS)
    }
  })

  const $btn = document.getElementById("ThemeSwitch")
  $btn.addEventListener("click", () => {
    $root.classList.toggle(DARK_CLASS)
    $root.classList.toggle(LIGHT_CLASS)
  })
</script>
