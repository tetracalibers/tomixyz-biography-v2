---
import type { CollectionEntry } from "astro:content"
import { SITE } from "$/config"
import MainLayout from "$/components/layout/MainLayout.astro"
import BaseHead from "$/components/layout/BaseHead.astro"
import ProseGridFill from "$/components/prose/ProseGridFill.astro"
import AvatarImage from "$components/article-header/layout-2/AvatarImage.astro"
import PublishDate from "$components/article-header/PublishDate.astro"
import type { MarkdownHeading } from "astro"
import BlogToc from "$components/toc/BlogToc.astro"
import Body from "$components/layout/Body.astro"

interface Props {
  content: CollectionEntry<"blog">["data"]
  headings: MarkdownHeading[]
  meta?: {
    title?: string
    description?: string
    ogimage?: string
  }
}

const { content, headings, meta } = Astro.props

const AUTHOR_NAME = SITE.author
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead
      image={meta?.ogimage ?? "/og-image.png"}
      title={meta?.title ? `${SITE.title} | ${meta.title}` : `${SITE.title} | ${content.title}`}
      description={meta?.description ?? content.description}
    />
  </head>
  <Body>
    <MainLayout>
      <div class="flex flex-col gap-8">
        <div class="py-4 mb-4 sm:mx-6 text-center md:text-left flex flex-col gap-8">
          <h1
            class="text-4xl md:text-5xl leading-normal font-extrabold text-theme-primary dark:text-theme-dark-primary"
          >
            {content.title}
          </h1>
          <p class="text-gray-500 dark:text-gray-100">{content.description}</p>
          <div
            class="text-gray-500 dark:text-gray-100 flex justify-center text-left md:flex-none md:justify-start flex-row gap-2"
          >
            <AvatarImage />
            <div class="flex flex-col border-l-2 pl-2">
              <span class="no-underline text-gray-500 dark:text-gray-100 hover:text-theme-primary">{AUTHOR_NAME}</span>
              <PublishDate date={content.date} />
            </div>
          </div>
        </div>
        <div class="_toc flex flex-col gap-6 items-start p-6 sm:p-8 sm:mx-6 text-slate-600 dark:text-slate-100">
          <h2 class="text-xl uppercase text-slate-500 dark:text-slate-200">Contents</h2>
          <BlogToc headings={headings} />
        </div>
        <ProseGridFill>
          <div class="_content text-lg leading-loose"><slot /></div>
        </ProseGridFill>
      </div>
    </MainLayout>
  </Body>
</html>

<style>
  ._content :global(p > img) {
    --fluid-bp-320-600: calc((100vw - 320px) / (600 - 320));
    --__max-height: 300px;
    --__space: clamp(16px, (16px + (68 - 16) * var(--fluid-bp-320-600)), 68px);

    width: 100%;
    height: 100%;
    max-height: calc(var(--__max-height) + var(--__space) * 2);

    box-sizing: border-box;

    object-position: center;
    object-fit: contain;
  }

  ._toc {
    backdrop-filter: saturate(200%);
    background-color: rgba(255, 255, 255, 0.6);
    border-radius: 12px;
    border: 1px solid rgba(209, 213, 219, 0.3);
  }
  :global(.dark) ._toc {
    background-color: rgba(255, 255, 255, 0.2);
  }
</style>
