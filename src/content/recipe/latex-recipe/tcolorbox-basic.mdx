---
title: tcolorboxによる囲みボックス実装事始め
date: "2025-08-30"
description: skin・余白・デフォルトスタイルのリセットから始めるカスタマイズ
tags:
  - latex
  - tcolorbox
series: latex-recipe
references:
  - title: tcolorboxのお誘い
    url: https://marukunalufd0123.hatenablog.com/entry/2019/03/15/071717
  - title: tcolorboxの基本
    url: https://texmedicine.hatenadiary.jp/entry/2015/12/17/000339
draft: true
---

import { Image } from "astro:assets"
import img_TcbDefault from "../../../assets/recipes/tcolorbox-basic/tcolorbox-default.png"
import img_DefaultStyleReset from "../../../assets/recipes/tcolorbox-basic/default-style-reset.png"
import img_DraftSkin from "../../../assets/recipes/tcolorbox-basic/draft-skin.png"
import img_DraftSkinOff from "../../../assets/recipes/tcolorbox-basic/draft-skin-off.png"
import img_BeforeSkipBalanced from "../../../assets/recipes/tcolorbox-basic/before-skip-balanced.png"
import img_UseLipsum from "../../../assets/recipes/tcolorbox-basic/use-lipsum.png"

[LaTeXで作った数学ノート](https://tomixyz-latex-notes.pages.dev/)では、独自に実装したさまざまな囲みボックスを利用しています。

そのほとんどは[tcolorbox](https://ctan.org/pkg/tcolorbox)をベースに実装しており、私自身が`tcolorbox`への理解を深める作業も兼ねて、その実装を振り返るブログを書きたいと思います。

今回から数回にわたって、`tcolorbox`の機能について掘り下げながら、さまざまな事例を紹介していきます。

## tcolorboxとは何か

LaTeXでは、[TikZ](https://tikz.dev/)という多機能な描画パッケージを利用することができます。（これが私がLaTeXをやめられない理由の一つです。）

TikZの機能を駆使すれば、さまざまな図版や装飾が実現可能です。
しかし、あまりに多機能なので、すべての機能を把握する学習コストは高く、また、TikZで1から構築するのは面倒なものもやはりあります。

そこで、よく使われるユースケースについては、より簡単なコードで実現できるようなTikZ派生パッケージが世に多く存在しています。
その中でも、カスタマイズ可能な囲みボックスを提供するパッケージが[tcolorbox](https://ctan.org/pkg/tcolorbox)です。

## tcolorboxの強力さに立ち向かう

`tcolorbox`の強力さを物語る記事はすでにたくさんあります！
たとえば、次のブログで紹介されている作例は筆者の憧れです。

- [tcolorboxでピカチュウフレーム](https://hohei3108.hatenablog.com/entry/2017/09/23/165454)

`tcolorbox`によるカスタム囲みボックスの実装は、最終的には[公式ドキュメント](https://ctan.tikz.jp/macros/latex/contrib/tcolorbox/tcolorbox.pdf)を参照しながら進めることになりますが、何もわからないまま500ページを超えるドキュメントを探索するのは苦行です。

そこで今回は、最初に知っておくとスムーズに入門できる、基本的な概念や機能に焦点を当てて解説します。主に取り上げる内容は次の通りです。

- `tcolorbox`の基本的な使い方（Hello, tcolorbox!）
- カスタム実装を始める前に知っておきたい仕組み
  - `skins`ライブラリによる描画方式の切り替え
  - `tcolorbox`における余白の種類と設定
- カスタム実装の第一歩
  - デフォルトスタイルのリセット
- カスタム囲みボックスの再利用
  - `\DeclareTColorBox`による独自の環境の定義
  - 柔軟な引数設定のための`xparse`構文入門

## Hello, tcolorbox!

プリアンブルに次のように書くことで、`tcolorbox`を使い始めることができます。

```latex
\usepackage{tcolorbox}
```

### tcolorbox環境の基本

`tcolorbox`パッケージは、囲み枠付きでコンテンツを描画する`tcolorbox`環境を提供します。

```latex
\begin{tcolorbox}[オプション]
  囲みたい内容
\end{tcolorbox}
```

LaTeXのコマンドや環境において、`[]`で囲まれた部分は指定してもしなくてもいい引数です。
そのため、次のように`[オプション]`の部分は省略して`tcolorbox`環境を使うことができます。

```latex
\begin{tcolorbox}
  こんにちは世界
\end{tcolorbox}
```

このコードは次のように描画されます。オプションを何も指定しなかった場合は、デフォルトのスタイル（黒い枠線にグレーの背景）が適用されるのです。

<Image src={img_TcbDefault} alt="" />

タイトルをつけたり、スタイルをカスタマイズしたりしたい場合には、`[]`の中にさまざまなオプションを指定していきます。これが`tcolorbox`環境の基本的な使い方です。

### ライブラリの読み込み

また、指定するオプションによっては、`tcolorbox`が提供するライブラリの読み込みが必要です。
ライブラリの読み込みは、次のようにプリアンブルで指定します。

```latex
\usepackage{tcolorbox}
\tcbuselibrary{ライブラリ名}
```

この時点で、どんなオプションやライブラリがあるのか、どのようなことができるのか、探索してみたい方には次の記事がおすすめです。

- [tcolorboxの基本](https://texmedicine.hatenadiary.jp/entry/2015/12/17/000339)

このシリーズでは、さまざまな囲みボックスの実例を取り上げる中で、必要なオプションやライブラリを都度紹介していくことにします。

### 補足：ダミーテキストによる表示確認

独自の囲みボックスを実装するときには、さまざまな長さの文章で表示を確認してみるとよいでしょう。

短い文章では気にならなかった余白の狭さなどが、複数行になると目立つようなことはよくあります。
また、ページをまたぐほど長い文章を入れたときの挙動はどうなるのか？など、文章の長さを変えながら表示を確認・調整することはとても大切です。

このような試作段階では、ダミーテキストを任意の長さで出力する`\lipsum`コマンドを使うと便利です。
プリアンブルに次の指定を加えることで、`\lipsum`コマンドが使えるようになります。

```latex
\usepackage{lipsum}
```

`\lipsum`コマンドでは、引数を指定することで、生成する文章の長さを簡単に変えることができます。
たとえば、`\lipsum[1][1-2]`と指定した場合は、Lorem ipsumの第1段落の第1文と第2文が出力されます。

```latex
\begin{tcolorbox}
  \lipsum[1][1-2]
\end{tcolorbox}
```

<Image src={img_UseLipsum} alt="" />

今後、このシリーズで示すデモコードでも、`\lipsum`コマンドによるダミーテキストを利用していきます。引数のさまざまな指定や省略については、次のサイトでわかりやすく解説されているので、参考にしてみてください。

- [LaTeX lipsum（追加版） --- Lorem Ipsumダミーテキストへの簡単なアクセス](https://konoyonohana.blog.fc2.com/blog-entry-566.html)

## 適切な描画方式を選ぶ（skinsライブラリ）

`tcolorbox`は、「どの描画エンジンを使うか」「どのようなスタイルを有効化するか」などの描画方式を、`skin`という仕組みで管理しています。

囲みボックスをカスタマイズするときには、デザインの複雑さや使いたい機能に応じて`skin`を使い分ける必要があります。
よく使う`skin`として、`empty`、`enhanced`、`draft`を覚えておくと便利です。

- `empty`：何も描かないようにする（デフォルトスタイルのリセットに使う）
- `enhanced`：TikZによる高度な描画機能を有効化する（カスタマイズ時にはほぼ必須）
- `draft`：ボックスの寸法やボックス内余白を可視化する（デバッグ用）

これらの`skin`への切り替えは`skins`ライブラリによって可能になるため、プリアンブルに次の指定を加えた上でカスタマイズを行うことがほとんどです。

```latex
\tcbuselibrary{skins}
```

## tcolorboxの余白を理解する

`tcolorbox`では、ボックスの余白の大きさや枠線の太さなどを細かく指定することができます。
細かいカスタマイズが可能な分、余白の設定だけでも数多くのオプションが用意されており、ドキュメントから自分の意図に合うオプションを探し出すのは大変な作業です。

まずは余白の種類をざっくりと把握しておくことで、ドキュメントの読解や実装がスムーズになります。

[公式ドキュメント](https://ctan.tikz.jp/macros/latex/contrib/tcolorbox/tcolorbox.pdf)にも、余白の種類が図で一覧化されている「Quick Reference」という章があり、とても便利です。
この記事では、その中でも特によく使うオプションに絞って概観しておきたいと思います。

### 内側の余白（padding）と枠線の太さ

```latex
\tcbset{
  myspacing/.style={
    sharp corners,
    toprule=0.5em, bottomrule=0.5em,
    leftrule=0.5em, rightrule=0.5em,
    boxsep=1em,
    top=2em, bottom=2em,
    left=2em, right=2em,
  }
}
```

<Image src={img_DraftSkinOff} alt="" />

```latex
\begin{tcolorbox}[myspacing]
  \lipsum[1][1-5]
\end{tcolorbox}
```

<Image src={img_DraftSkin} alt="" />

```latex
\begin{tcolorbox}[myspacing, draft]
  \lipsum[1][1-5]
\end{tcolorbox}
```

### ボックスの外側の余白（margin）

ボックスの外側、特に上下の余白は、ボックスとその前後の段落との間隔を制御する上で重要です。
それぞれ、次のオプションで指定します。

- `before skip`：ボックスの上の余白（前の段落との間隔）
- `after skip`：ボックスの下の余白（次の段落との間隔）
- `beforeafter skip`：ボックスの上下の余白（まとめて同じサイズに設定）

また、これらと似たオプションとして、`before skip balanced`、`after skip balanced`、`beforeafter skip balanced`というオプションも用意されています。

<Image src={img_BeforeSkipBalanced} alt="" />

```latex
\lipsum[1][1]

\begin{tcolorbox}[before skip=0pt]
  \texttt{before skip=0pt}
\end{tcolorbox}

\lipsum[1][1]

\begin{tcolorbox}[before skip balanced=0pt]
  \texttt{before skip balanced=0pt}
\end{tcolorbox}
```

- [What is the difference between "before skip" and "before skip balanced" in a tcolorbox?](https://tex.stackexchange.com/questions/586946/what-is-the-difference-between-before-skip-and-before-skip-balanced-in-a-tco)

## デフォルトスタイルのリセット

囲みボックスをカスタマイズするときには、まずはデフォルトのスタイルを消してから、独自にスタイルを設定し直すことがよくあります。

デフォルトのスタイルのうち、何をリセットしたいかによって、オプションや`skin`を使い分けます。

<Image src={img_DefaultStyleReset} alt="" />

```latex showLineNumbers {3-5,9-11,15-17,21-23}
\lipsum[1][1-2]

\begin{tcolorbox}
  こんにちは世界（\texttt{default}）
\end{tcolorbox}

\lipsum[1][3-4]

\begin{tcolorbox}[enhanced, frame hidden]
  こんにちは世界（\texttt{enhanced, frame hidden}）
\end{tcolorbox}

\lipsum[1][5-6]

\begin{tcolorbox}[empty]
  こんにちは世界（\texttt{empty}）
\end{tcolorbox}

\lipsum[2][1-2]

\begin{tcolorbox}[size=minimal]
  こんにちは世界（\texttt{size=minimal}）
\end{tcolorbox}

\lipsum[2][3-4]
```

### 余白をリセット

`size=minimal`を指定することで、デフォルトの余白をすべて消すことができます。

```latex
\begin{tcolorbox}[size=minimal]
  こんにちは世界
\end{tcolorbox}
```

### 枠線や背景などのすべての装飾をリセット

枠線や背景色など、デフォルトの装飾をすべて消すには、`empty`オプションを指定します。

```latex
% \tcbuselibrary{skins} が必要
\begin{tcolorbox}[empty]
  こんにちは世界
\end{tcolorbox}
```

`empty`オプションを利用するには、プリアンブルで`skins`ライブラリの読み込みが必要です。
`skins`は描画方式を切り替えるためのライブラリであり、`empty`によって「何も描かない」描画方式に切りかえます。

### 枠線だけを消す

```latex
% \tcbuselibrary{skins} が必要
\begin{tcolorbox}[enhanced, frame hidden]
  こんにちは世界
\end{tcolorbox}
```

なお、背景色を消したい場合は`interior hidden`を指定します。

`frame hidden`と`interior hidden`を両方指定すると、見た目としては`empty`を指定した場合と同じになりますが、`empty`と`enhanced`では使える機能が異なるため、必要に応じて使い分けていきます。

## 独自の環境として定義する

同じオプションを指定した`tcolorbox`環境を複数箇所で使う場合、コピペして使い回していると、修正したくなったときにとても大変です。

`tcolorbox`では、オプションを指定した囲み枠に名前をつけて、独自の環境として呼び出せるように定義することもできます。

```latex
\DeclareTColorBox{環境名}{引数}{%
  tcolorboxのオプション
}
```

文章の周りに余白を設けるだけの、シンプルな環境を定義してみましょう。

```latex
% \tcbuselibrary{skins} が必要
\DeclareTColorBox{spacebox}{}{%
  empty,
  beforeafter skip=\baselineskip
}
```

このように定義しておくと、`spacebox`環境として使い回しが可能になります。

```latex
\begin{spacebox}
  こんにちは世界
\end{spacebox}
```

### 他の段落と調和させる

`spacebox`環境の定義で指定した`beforeafter skip`は、ボックスの上下の外側余白をまとめて指定するオプションです。

ここでは、本文の行送り量 `\baselineskip` と同じだけ、上下に余白を設けています。

この指定により、ボックスとその前後の文章の間だけが特に狭くなることなく、ボックスもひとつの段落として、段落間の余白を統一することができます。

- TODO: 指定なしの場合と指定ありの場合のキャプチャ

## 引数で柔軟性を高める

この`spacebox`環境を使っていく中で、たとえば「文章を中央揃えしたい」箇所も出てくるかもしれません。

その場合は`spacebox`環境の中に`center`環境をネストすれば事足りますが、他にも「背景色をつけてより強調したい箇所」などが出てきたらどうでしょうか。
tcolorboxのオプションを追加で指定できるような仕組みがあると便利そうです。

`\DeclareTColorBox`では、引数を受け入れる環境を定義することができます。

tcolorboxのオプションを追加で指定できるようにするには、`spacebox`環境の定義を次のように修正します。

```latex
% \tcbuselibrary{skins} が必要
\DeclareTColorBox{spacebox}{O{}}{%
  empty,
  beforeafter skip=\baselineskip, #1
}
```

新たに追加した`O{}`という文字列が、第1引数を表しています。
`O`は、この引数は指定してもしなくてもいい（optional）であることを表し、`{}`の中には、引数が指定されなかった場合のデフォルト値を設定します。ここでは`{}`の中身を空にしているので、引数が指定されなかった場合には何もしないという意味になります。

このような引数設定の構文は、`xparse`パッケージに準ずるものです。
他にもいろいろな引数の設定が可能なので、詳しくは次の記事などを参考にしてみてください。（このシリーズの後の回でも、より高度な引数設定の事例を紹介する予定です。）

- [xparseパッケージでスゴイLaTeXマクロを作ろう！](https://qiita.com/zr_tex8r/items/50168ad7087516c3e139)

第1引数として指定された内容は、`#1`で参照できます。第1引数として`tcolorbox`のオプションが指定された場合は、`empty`や`before after skip`に続けて、そのオプションを適用するようにしています。

このように定義した`spacebox`環境は、これまで通りそのままでも使えますし、引数を使って`tcolorbox`のオプションを追加したり上書きしたりすることもできるようになります。

```latex
TODO: そのままのコードと、valign=flush centerを指定した場合のコード
```

- TODO: キャプチャ

### 中央揃え（`flush`と`flush center`）

- TODO: 違いを調べて書く
